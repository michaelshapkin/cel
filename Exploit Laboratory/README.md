# Exploit Laboratory ‚Äì The Sandboxed Adversarial Environment

**Exploit Laboratory** is the core simulation engine of the CEL (Continuous Execution Layer). It provides a high-fidelity, isolated environment where AI agents can autonomously diagnose vulnerabilities, develop exploits, and verify them against real-world blockchain state.

---

## üî¨ Overview

Inspired by **Anthropic‚Äôs 2025 research** on AI exploit discovery, this laboratory replicates the "Cybersecurity Superintelligence" workflow. It bridges the gap between static analysis and executable proof-of-concepts (PoCs).

### Key Features
- **Deterministic Simulation**: Uses **Anvil** (Foundry) to fork live networks at specific historical blocks.
- **Full Toolchain Integration**: Pre-configured with Forge, Cast, and multi-version Solidity support via `solc-select`.
- **Reality Reconstruction**: Automatically generates high-fidelity system prompts that describe the contract state, balances, and liquidity pools at the exact moment of the vulnerability.
- **Sandboxed Execution**: Every exploit attempt runs in an isolated Docker container (`scone-simulator`) to ensure safety and reproducibility.

---

## üèóÔ∏è Architecture

### 1. `run_case.py` (The Orchestrator)
The main entry point for starting a simulation. It handles:
- Fetching case metadata from `data/benchmark.csv`.
- Locating or downloading contract source code.
- Bootstrapping the `scone-simulator` container.
- Initializing the Anvil fork at the correct block.
- Provisioning the workspace with necessary templates and sources.

### 2. `scone-simulator` (The Docker Environment)
A specialized image built for blockchain security research:
- **Foundry Suite**: `forge`, `cast`, `anvil` for development and testing.
- **Multi-Compiler**: Pre-installed Solidity versions from `0.4.24` to `0.8.20`.
- **Smart Tools**: Custom Python utilities for on-chain discovery and compiler management.
- **OpenZeppelin Libs**: Built-in support for standard contract patterns.

### 3. Core Utilities (`core/`)
- `fetcher.py`: Retrieves contract sources and ABIs from block explorers.
- `generate_context.py`: Synthesizes the environment state into a Markdown system prompt for the AI.
- `compiler_manager.py`: Bridges the gap between disparate contract files and the Foundry build system.
- `uniswap-smart-path.py`: Finds optimal trading paths for liquidity-based exploits.

---

## üöÄ Getting Started

### Prerequisites
- **Docker**: Must be installed and running.
- **Python 3.10+**: With `pip` installed.
- **Ankr API Key**: Required for high-performance RPC access.

### Installation
1. Navigate to the laboratory:
   ```bash
   cd "Exploit Laboratory"
   ```
2. Setup environment variables:
   ```bash
   cp .env.example .env
   # Add your ANKR_API_KEY to .env
   ```
3. Install dependencies:
   ```bash
   pip install -r requirements.txt
   ```

### Running a Case
To start a simulation for a specific target (e.g., the Bancor exploit):
```bash
python3 run_case.py 0x5f58058C0eC971492166763c8C22632B583F667f
```

This will:
1. Start a Docker container named `cel-sim-<addr>`.
2. Generate a `system_prompt.txt` for your AI agent.
3. Print instructions on how to enter the container.

---

## üß™ Workflow inside the Lab

Once the case is ready, the typical workflow (whether manual or agentic) is:
1. **Analyze**: Read the `system_prompt.txt` to understand the environment.
2. **Develop**: Modify `src/FlawVerifier.sol` inside the container to implement the exploit logic.
3. **Test**: Run `forge test` to verify if the exploit successfully captures the "flag" (e.g., drains funds).
4. **Iterate**: Use `cast` to probe state and refine the attack strategy.

---

## üìú Credits & Acknowledgments
- **Anthropic**: For the groundbreaking [Exploit Discovery research](https://red.anthropic.com/2025/smart-contracts/).
- **SCONE-bench**: For the standardized benchmark dataset.
- **DeFiHackLabs**: For the extensive library of historical exploit PoCs.

> *Exploit Laboratory is part of the CEL project by Michael Shapkin.*
